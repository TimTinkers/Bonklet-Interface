<!DOCTYPE html>
<!-- The Bonkler is a religious artifact, and the Bonklets are icons borne by a noble order of paladins safeguarding reliquaries containing the aforementioned religious artifacts. -->
<html>

<head>
	<title>
		Bonklet
	</title>
	<link rel="stylesheet" href="./style/home.css">
	<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
	<link rel="manifest" href="/site.webmanifest">
	<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#e81111">
	<meta name="msapplication-TileColor" content="#000000">
	<meta name="theme-color" content="#ffffff">
</head>

<body>
	<div id="bonklet-header">
		Bonklet Bidder
	</div>
	<!-- An informational panel. -->
	<div id="information">
		This is the frontend interface for a fractionalized <a href="https://bonkler.remilia.org">Bonkler</a> bidding
		system. Bonkler is an on-chain religious artifact by the <a href="https://remilia.org">Remilia Corporation</a>, this
		site and the fractionalized bidder are not affiliated with Remilia. The address of the deployed
		fractionalized bidder is <a
			href="https://etherscan.io/address/0x7964929ecbaf3f9704edcd6120126f6e85900883#code">0x7964929Ecbaf3F9704edCd6120126F6E85900883</a>
		and you can find its source code <a href="https://github.com/TimTinkers/Bonklet">here</a>. The Bonklet
		fractionalized bidder was made by <a href="https://twitter.com/_Enoch">Tim</a>, if you have any questions come join
		the Discord <a href="http://discord.gg/xjXySxKRXk">here</a>.
	</div>

	<!-- Display details about the current Bonkler auction. -->
	<div id="bonkler-details">
		Loading ...
	</div>

	<!-- Display details about the current Bonklet bid. -->
	<div id="bonklet-details">
		Loading ...
	</div>

	<!-- Display a bid contribution field. -->
	<div id="bid-area">
		<input id="bid-amount" type="number" min="0.1" step="0.1" value="0.1">
		<button id="contribute-bid">
			Contribute Bid
		</button>
	</div>

	<!-- Display a Bonkler power leaderboard. -->
	<div id="leaderboard-area">
		<h1>
			Bonkler Energy
		</h1>
		<ul id="leaderboard">
			Loading ...
		</ul>
	</div>

	<!-- A script for purchasing. -->
	<script type="module">
		import {ethers} from 'https://cdnjs.cloudflare.com/ajax/libs/ethers/5.6.8/ethers.esm.min.js';

		// General configuration.
		const POLL_RATE = 10000;
		const INFURA_PROJECT_ID = '8f4c8108a4fc4cae8ad12dd3f402c49f';

		// Bonkler configuration.
		const BONKLER_AUCTION_ADDRESS =
			'0xF421391011Dc77c0C2489d384C26e915Efd9e2C5';
		const BONKLER_AUCTION_ABI = [
			{
				"anonymous": false,
				"inputs": [
					{
						"indexed": true,
						"internalType": "uint256",
						"name": "bonklerId",
						"type": "uint256"
					},
					{
						"indexed": false,
						"internalType": "address",
						"name": "bidder",
						"type": "address"
					},
					{
						"indexed": false,
						"internalType": "uint256",
						"name": "amount",
						"type": "uint256"
					},
					{
						"indexed": false,
						"internalType": "bool",
						"name": "extended",
						"type": "bool"
					}
				],
				"name": "AuctionBid",
				"type": "event"
			},
			{
				"anonymous": false,
				"inputs": [
					{
						"indexed": true,
						"internalType": "uint256",
						"name": "bonklerId",
						"type": "uint256"
					},
					{
						"indexed": false,
						"internalType": "uint256",
						"name": "startTime",
						"type": "uint256"
					},
					{
						"indexed": false,
						"internalType": "uint256",
						"name": "endTime",
						"type": "uint256"
					}
				],
				"name": "AuctionCreated",
				"type": "event"
			},
			{
				"anonymous": false,
				"inputs": [
					{
						"indexed": false,
						"internalType": "uint256",
						"name": "duration",
						"type": "uint256"
					}
				],
				"name": "AuctionDurationUpdated",
				"type": "event"
			},
			{
				"anonymous": false,
				"inputs": [
					{
						"indexed": true,
						"internalType": "uint256",
						"name": "bonklerId",
						"type": "uint256"
					},
					{
						"indexed": false,
						"internalType": "uint256",
						"name": "endTime",
						"type": "uint256"
					}
				],
				"name": "AuctionExtended",
				"type": "event"
			},
			{
				"anonymous": false,
				"inputs": [
					{
						"indexed": true,
						"internalType": "uint256",
						"name": "bonklerId",
						"type": "uint256"
					},
					{
						"indexed": false,
						"internalType": "address",
						"name": "winner",
						"type": "address"
					},
					{
						"indexed": false,
						"internalType": "uint256",
						"name": "amount",
						"type": "uint256"
					}
				],
				"name": "AuctionSettled",
				"type": "event"
			},
			{
				"anonymous": false,
				"inputs": [
					{
						"indexed": false,
						"internalType": "uint256",
						"name": "timeBuffer",
						"type": "uint256"
					}
				],
				"name": "AuctionTimeBufferUpdated",
				"type": "event"
			},
			{
				"anonymous": false,
				"inputs": [
					{
						"indexed": true,
						"internalType": "uint256",
						"name": "bonklerId",
						"type": "uint256"
					}
				],
				"name": "BonklerRedeemed",
				"type": "event"
			},
			{
				"inputs": [],
				"name": "auctionData",
				"outputs": [
					{
						"components": [
							{
								"internalType": "address",
								"name": "bidder",
								"type": "address"
							},
							{
								"internalType": "uint96",
								"name": "amount",
								"type": "uint96"
							},
							{
								"internalType": "uint96",
								"name": "withdrawable",
								"type": "uint96"
							},
							{
								"internalType": "uint40",
								"name": "startTime",
								"type": "uint40"
							},
							{
								"internalType": "uint40",
								"name": "endTime",
								"type": "uint40"
							},
							{
								"internalType": "uint24",
								"name": "bonklerId",
								"type": "uint24"
							},
							{
								"internalType": "uint24",
								"name": "generationHashesLength",
								"type": "uint24"
							},
							{
								"internalType": "bool",
								"name": "settled",
								"type": "bool"
							},
							{
								"internalType": "uint8",
								"name": "reservePercentage",
								"type": "uint8"
							},
							{
								"internalType": "address",
								"name": "bonklers",
								"type": "address"
							},
							{
								"internalType": "uint96",
								"name": "reservePrice",
								"type": "uint96"
							},
							{
								"internalType": "uint96",
								"name": "bidIncrement",
								"type": "uint96"
							},
							{
								"internalType": "uint32",
								"name": "duration",
								"type": "uint32"
							},
							{
								"internalType": "uint32",
								"name": "timeBuffer",
								"type": "uint32"
							},
							{
								"internalType": "uint256",
								"name": "bonklersBalance",
								"type": "uint256"
							},
							{
								"internalType": "uint256",
								"name": "bonklersTotalRedeemed",
								"type": "uint256"
							}
						],
						"internalType": "struct BonklerAuction.AuctionData",
						"name": "data",
						"type": "tuple"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "hasEnded",
				"outputs": [
					{
						"internalType": "bool",
						"name": "",
						"type": "bool"
					}
				],
				"stateMutability": "view",
				"type": "function"
			}
		];

		// Bonklet bidder configuration.
		const BONKLET_BIDDER_0 = '0x95F75bc6Bbd1a5C3474a61a0514F519389262FE6';
		const BONKLET_BIDDER_1 = '0x7964929Ecbaf3F9704edCd6120126F6E85900883';
		const BONKLET_BIDDER_ABI = [
			{
				"anonymous": false,
				"inputs": [
					{
						"indexed": true,
						"internalType": "address",
						"name": "bidder",
						"type": "address"
					},
					{
						"indexed": false,
						"internalType": "uint256",
						"name": "bonklerId",
						"type": "uint256"
					},
					{
						"indexed": false,
						"internalType": "uint256",
						"name": "totalAmount",
						"type": "uint256"
					}
				],
				"name": "BidExecuted",
				"type": "event"
			},
			{
				"anonymous": false,
				"inputs": [
					{
						"indexed": true,
						"internalType": "address",
						"name": "bidder",
						"type": "address"
					},
					{
						"indexed": false,
						"internalType": "uint256",
						"name": "bonklerId",
						"type": "uint256"
					},
					{
						"indexed": false,
						"internalType": "uint256",
						"name": "amount",
						"type": "uint256"
					},
					{
						"indexed": false,
						"internalType": "uint256",
						"name": "totalAmount",
						"type": "uint256"
					}
				],
				"name": "BidStaged",
				"type": "event"
			},
			{
				"anonymous": false,
				"inputs": [
					{
						"indexed": true,
						"internalType": "address",
						"name": "bidder",
						"type": "address"
					},
					{
						"indexed": false,
						"internalType": "uint256",
						"name": "bonklerId",
						"type": "uint256"
					},
					{
						"indexed": false,
						"internalType": "uint256",
						"name": "totalAmount",
						"type": "uint256"
					}
				],
				"name": "BidWithdrawn",
				"type": "event"
			},
			{
				"anonymous": false,
				"inputs": [
					{
						"indexed": true,
						"internalType": "address",
						"name": "claimant",
						"type": "address"
					},
					{
						"indexed": false,
						"internalType": "uint256",
						"name": "bonkletId",
						"type": "uint256"
					},
					{
						"indexed": false,
						"internalType": "uint256",
						"name": "reward",
						"type": "uint256"
					}
				],
				"name": "BonkletClaimed",
				"type": "event"
			},
			{
				"anonymous": false,
				"inputs": [
					{
						"indexed": true,
						"internalType": "address",
						"name": "voter",
						"type": "address"
					},
					{
						"indexed": false,
						"internalType": "uint256",
						"name": "bonklerId",
						"type": "uint256"
					},
					{
						"indexed": false,
						"internalType": "uint256",
						"name": "bonkletId",
						"type": "uint256"
					}
				],
				"name": "RedemptionExecuted",
				"type": "event"
			},
			{
				"anonymous": false,
				"inputs": [
					{
						"indexed": true,
						"internalType": "address",
						"name": "voter",
						"type": "address"
					},
					{
						"indexed": false,
						"internalType": "uint256",
						"name": "bonklerId",
						"type": "uint256"
					},
					{
						"indexed": false,
						"internalType": "uint256",
						"name": "bonkletId",
						"type": "uint256"
					},
					{
						"indexed": false,
						"internalType": "bool",
						"name": "signal",
						"type": "bool"
					},
					{
						"indexed": false,
						"internalType": "uint256",
						"name": "shares",
						"type": "uint256"
					}
				],
				"name": "RedemptionVote",
				"type": "event"
			},
			{
				"anonymous": false,
				"inputs": [
					{
						"indexed": true,
						"internalType": "address",
						"name": "settler",
						"type": "address"
					},
					{
						"indexed": false,
						"internalType": "uint256",
						"name": "bonklerId",
						"type": "uint256"
					}
				],
				"name": "Settled",
				"type": "event"
			},
			{
				"anonymous": false,
				"inputs": [
					{
						"indexed": true,
						"internalType": "address",
						"name": "voter",
						"type": "address"
					},
					{
						"indexed": false,
						"internalType": "uint256",
						"name": "bonklerId",
						"type": "uint256"
					},
					{
						"indexed": false,
						"internalType": "uint256",
						"name": "bonkletId",
						"type": "uint256"
					},
					{
						"indexed": false,
						"internalType": "address",
						"name": "destination",
						"type": "address"
					}
				],
				"name": "TransferExecuted",
				"type": "event"
			},
			{
				"anonymous": false,
				"inputs": [
					{
						"indexed": true,
						"internalType": "address",
						"name": "voter",
						"type": "address"
					},
					{
						"indexed": false,
						"internalType": "uint256",
						"name": "bonklerId",
						"type": "uint256"
					},
					{
						"indexed": false,
						"internalType": "uint256",
						"name": "bonkletId",
						"type": "uint256"
					},
					{
						"indexed": false,
						"internalType": "address",
						"name": "destination",
						"type": "address"
					},
					{
						"indexed": false,
						"internalType": "bool",
						"name": "signal",
						"type": "bool"
					},
					{
						"indexed": false,
						"internalType": "uint256",
						"name": "shares",
						"type": "uint256"
					}
				],
				"name": "TransferVote",
				"type": "event"
			},
			{
				"inputs": [],
				"name": "BIDDER_LIMIT",
				"outputs": [
					{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "BID_MINIMUM",
				"outputs": [
					{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "BONKLER",
				"outputs": [
					{
						"internalType": "address",
						"name": "",
						"type": "address"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "BONKLER_AUCTION",
				"outputs": [
					{
						"internalType": "address",
						"name": "",
						"type": "address"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "BONKLER_TREASURY",
				"outputs": [
					{
						"internalType": "address",
						"name": "",
						"type": "address"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "BONKLET",
				"outputs": [
					{
						"internalType": "address",
						"name": "",
						"type": "address"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [],
				"name": "REDEMPTION_QUORUM",
				"outputs": [
					{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					}
				],
				"name": "bonkletData",
				"outputs": [
					{
						"internalType": "uint128",
						"name": "bonklerId",
						"type": "uint128"
					},
					{
						"internalType": "uint128",
						"name": "stagedEther",
						"type": "uint128"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					},
					{
						"internalType": "address",
						"name": "",
						"type": "address"
					}
				],
				"name": "callerStagedBids",
				"outputs": [
					{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "uint256",
						"name": "_bonkletId",
						"type": "uint256"
					}
				],
				"name": "claim",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "uint256",
						"name": "_bonkletId",
						"type": "uint256"
					}
				],
				"name": "redeem",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					}
				],
				"name": "redeemed",
				"outputs": [
					{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					}
				],
				"name": "redemptionShares",
				"outputs": [
					{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					}
				],
				"name": "redemptionVoted",
				"outputs": [
					{
						"internalType": "bool",
						"name": "",
						"type": "bool"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "uint256",
						"name": "_bonklerId",
						"type": "uint256"
					}
				],
				"name": "settle",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					}
				],
				"name": "settled",
				"outputs": [
					{
						"internalType": "bool",
						"name": "",
						"type": "bool"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "uint256",
						"name": "_bonklerId",
						"type": "uint256"
					},
					{
						"internalType": "uint256",
						"name": "_generationHash",
						"type": "uint256"
					}
				],
				"name": "stageBid",
				"outputs": [],
				"stateMutability": "payable",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					}
				],
				"name": "stagedTotal",
				"outputs": [
					{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "uint256",
						"name": "_bonkletId",
						"type": "uint256"
					},
					{
						"internalType": "address",
						"name": "_destination",
						"type": "address"
					}
				],
				"name": "transfer",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					},
					{
						"internalType": "address",
						"name": "",
						"type": "address"
					}
				],
				"name": "transferShares",
				"outputs": [
					{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "uint256",
						"name": "",
						"type": "uint256"
					},
					{
						"internalType": "address",
						"name": "",
						"type": "address"
					}
				],
				"name": "transferVoted",
				"outputs": [
					{
						"internalType": "bool",
						"name": "",
						"type": "bool"
					}
				],
				"stateMutability": "view",
				"type": "function"
			},
			{
				"inputs": [
					{
						"internalType": "uint256",
						"name": "_bonklerId",
						"type": "uint256"
					}
				],
				"name": "withdrawBid",
				"outputs": [],
				"stateMutability": "nonpayable",
				"type": "function"
			}
		];

		// Bonkler NFT configuration.
		const BONKLER_NFT_ADDRESS = '0xABFaE8A54e6817F57F9De7796044E9a60e61ad67';
		const BONKLER_NFT_ABI = [
			{"inputs": [], "stateMutability": "nonpayable", "type": "constructor"}, {"anonymous": false, "inputs": [{"indexed": true, "internalType": "address", "name": "owner", "type": "address"}, {"indexed": true, "internalType": "address", "name": "approved", "type": "address"}, {"indexed": true, "internalType": "uint256", "name": "tokenId", "type": "uint256"}], "name": "Approval", "type": "event"}, {"anonymous": false, "inputs": [{"indexed": true, "internalType": "address", "name": "owner", "type": "address"}, {"indexed": true, "internalType": "address", "name": "operator", "type": "address"}, {"indexed": false, "internalType": "bool", "name": "approved", "type": "bool"}], "name": "ApprovalForAll", "type": "event"}, {"anonymous": false, "inputs": [{"indexed": true, "internalType": "address", "name": "previousOwner", "type": "address"}, {"indexed": true, "internalType": "address", "name": "newOwner", "type": "address"}], "name": "OwnershipTransferred", "type": "event"}, {"anonymous": false, "inputs": [{"indexed": true, "internalType": "address", "name": "from", "type": "address"}, {"indexed": true, "internalType": "address", "name": "to", "type": "address"}, {"indexed": true, "internalType": "uint256", "name": "tokenId", "type": "uint256"}], "name": "Transfer", "type": "event"}, {"inputs": [], "name": "START_TOKEN_ID", "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}], "stateMutability": "view", "type": "function"}, {"inputs": [{"internalType": "address", "name": "to", "type": "address"}, {"internalType": "uint256", "name": "tokenId", "type": "uint256"}], "name": "approve", "outputs": [], "stateMutability": "nonpayable", "type": "function"}, {"inputs": [{"internalType": "address", "name": "owner", "type": "address"}], "name": "balanceOf", "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}], "stateMutability": "view", "type": "function"}, {"inputs": [], "name": "baseURILocked", "outputs": [{"internalType": "bool", "name": "", "type": "bool"}], "stateMutability": "view", "type": "function"}, {"inputs": [{"internalType": "uint256[]", "name": "tokenIds", "type": "uint256[]"}], "name": "exist", "outputs": [{"internalType": "bool[]", "name": "results", "type": "bool[]"}], "stateMutability": "view", "type": "function"}, {"inputs": [{"internalType": "uint256", "name": "tokenId", "type": "uint256"}], "name": "exists", "outputs": [{"internalType": "bool", "name": "", "type": "bool"}], "stateMutability": "view", "type": "function"}, {"inputs": [{"internalType": "uint256", "name": "tokenId", "type": "uint256"}], "name": "getApproved", "outputs": [{"internalType": "address", "name": "", "type": "address"}], "stateMutability": "view", "type": "function"}, {"inputs": [{"internalType": "uint256", "name": "tokenId", "type": "uint256"}], "name": "getBonklerHash", "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}], "stateMutability": "view", "type": "function"}, {"inputs": [{"internalType": "uint256", "name": "tokenId", "type": "uint256"}], "name": "getBonklerShares", "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}], "stateMutability": "view", "type": "function"}, {"inputs": [{"internalType": "address", "name": "owner", "type": "address"}, {"internalType": "address", "name": "operator", "type": "address"}], "name": "isApprovedForAll", "outputs": [{"internalType": "bool", "name": "", "type": "bool"}], "stateMutability": "view", "type": "function"}, {"inputs": [], "name": "lockBaseURI", "outputs": [], "stateMutability": "nonpayable", "type": "function"}, {"inputs": [], "name": "lockMint", "outputs": [], "stateMutability": "nonpayable", "type": "function"}, {"inputs": [], "name": "lockMinter", "outputs": [], "stateMutability": "nonpayable", "type": "function"}, {"inputs": [{"internalType": "uint256", "name": "generationHash", "type": "uint256"}], "name": "mint", "outputs": [{"internalType": "uint256", "name": "tokenId", "type": "uint256"}], "stateMutability": "payable", "type": "function"}, {"inputs": [], "name": "mintLocked", "outputs": [{"internalType": "bool", "name": "", "type": "bool"}], "stateMutability": "view", "type": "function"}, {"inputs": [], "name": "minterLocked", "outputs": [{"internalType": "bool", "name": "", "type": "bool"}], "stateMutability": "view", "type": "function"}, {"inputs": [], "name": "name", "outputs": [{"internalType": "string", "name": "", "type": "string"}], "stateMutability": "view", "type": "function"}, {"inputs": [], "name": "nextTokenId", "outputs": [{"internalType": "uint32", "name": "", "type": "uint32"}], "stateMutability": "view", "type": "function"}, {"inputs": [], "name": "owner", "outputs": [{"internalType": "address", "name": "", "type": "address"}], "stateMutability": "view", "type": "function"}, {"inputs": [{"internalType": "uint256", "name": "tokenId", "type": "uint256"}], "name": "ownerOf", "outputs": [{"internalType": "address", "name": "", "type": "address"}], "stateMutability": "view", "type": "function"}, {"inputs": [{"internalType": "uint256", "name": "tokenId", "type": "uint256"}], "name": "redeemBonkler", "outputs": [], "stateMutability": "nonpayable", "type": "function"}, {"inputs": [], "name": "renounceOwnership", "outputs": [], "stateMutability": "nonpayable", "type": "function"}, {"inputs": [{"internalType": "address", "name": "from", "type": "address"}, {"internalType": "address", "name": "to", "type": "address"}, {"internalType": "uint256", "name": "tokenId", "type": "uint256"}], "name": "safeTransferFrom", "outputs": [], "stateMutability": "nonpayable", "type": "function"}, {"inputs": [{"internalType": "address", "name": "from", "type": "address"}, {"internalType": "address", "name": "to", "type": "address"}, {"internalType": "uint256", "name": "tokenId", "type": "uint256"}, {"internalType": "bytes", "name": "data", "type": "bytes"}], "name": "safeTransferFrom", "outputs": [], "stateMutability": "nonpayable", "type": "function"}, {"inputs": [{"internalType": "address", "name": "operator", "type": "address"}, {"internalType": "bool", "name": "approved", "type": "bool"}], "name": "setApprovalForAll", "outputs": [], "stateMutability": "nonpayable", "type": "function"}, {"inputs": [{"internalType": "string", "name": "baseURI", "type": "string"}], "name": "setBaseURI", "outputs": [], "stateMutability": "nonpayable", "type": "function"}, {"inputs": [{"internalType": "address", "name": "minter", "type": "address"}], "name": "setMinter", "outputs": [], "stateMutability": "nonpayable", "type": "function"}, {"inputs": [{"internalType": "bytes4", "name": "interfaceId", "type": "bytes4"}], "name": "supportsInterface", "outputs": [{"internalType": "bool", "name": "", "type": "bool"}], "stateMutability": "view", "type": "function"}, {"inputs": [], "name": "symbol", "outputs": [{"internalType": "string", "name": "", "type": "string"}], "stateMutability": "view", "type": "function"}, {"inputs": [{"internalType": "uint256", "name": "tokenId", "type": "uint256"}], "name": "tokenURI", "outputs": [{"internalType": "string", "name": "result", "type": "string"}], "stateMutability": "view", "type": "function"}, {"inputs": [{"internalType": "address", "name": "owner", "type": "address"}], "name": "tokensOfOwner", "outputs": [{"internalType": "uint256[]", "name": "tokenIds", "type": "uint256[]"}], "stateMutability": "view", "type": "function"}, {"inputs": [], "name": "totalMinted", "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}], "stateMutability": "view", "type": "function"}, {"inputs": [], "name": "totalRedeemed", "outputs": [{"internalType": "uint32", "name": "", "type": "uint32"}], "stateMutability": "view", "type": "function"}, {"inputs": [], "name": "totalSupply", "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}], "stateMutability": "view", "type": "function"}, {"inputs": [{"internalType": "address", "name": "from", "type": "address"}, {"internalType": "address", "name": "to", "type": "address"}, {"internalType": "uint256", "name": "tokenId", "type": "uint256"}], "name": "transferFrom", "outputs": [], "stateMutability": "nonpayable", "type": "function"}, {"inputs": [{"internalType": "address", "name": "newOwner", "type": "address"}], "name": "transferOwnership", "outputs": [], "stateMutability": "nonpayable", "type": "function"}, {"inputs": [{"internalType": "uint256", "name": "tokenId", "type": "uint256"}, {"internalType": "address", "name": "to", "type": "address"}], "name": "transferPurchasedBonkler", "outputs": [], "stateMutability": "payable", "type": "function"}
		];

		// Bonklet NFT configuration.
		const BONKLET_NFT_ADDRESS = '0x68c51841b4dF39FB84f292cA26B76E7E2b4f1965';
		const BONKLET_NFT_ABI = [
			{"inputs": [{"internalType": "string", "name": "_name", "type": "string"}, {"internalType": "string", "name": "_symbol", "type": "string"}, {"internalType": "string", "name": "_metadataURI", "type": "string"}, {"internalType": "uint256", "name": "_cap", "type": "uint256"}], "stateMutability": "nonpayable", "type": "constructor"}, {"inputs": [], "name": "ApprovalCallerNotOwnerNorApproved", "type": "error"}, {"inputs": [], "name": "ApprovalQueryForNonexistentToken", "type": "error"}, {"inputs": [], "name": "CapExceeded", "type": "error"}, {"inputs": [], "name": "MintToZeroAddress", "type": "error"}, {"inputs": [], "name": "MintZeroQuantity", "type": "error"}, {"inputs": [], "name": "NotAnAdmin", "type": "error"}, {"inputs": [], "name": "OwnerQueryForNonexistentToken", "type": "error"}, {"inputs": [], "name": "TransferCallerNotOwnerNorApproved", "type": "error"}, {"inputs": [], "name": "TransferFromIncorrectOwner", "type": "error"}, {"inputs": [], "name": "TransferToNonERC721ReceiverImplementer", "type": "error"}, {"inputs": [], "name": "TransferToZeroAddress", "type": "error"}, {"inputs": [], "name": "URIQueryForNonexistentToken", "type": "error"}, {"anonymous": false, "inputs": [{"indexed": true, "internalType": "address", "name": "owner", "type": "address"}, {"indexed": true, "internalType": "address", "name": "approved", "type": "address"}, {"indexed": true, "internalType": "uint256", "name": "tokenId", "type": "uint256"}], "name": "Approval", "type": "event"}, {"anonymous": false, "inputs": [{"indexed": true, "internalType": "address", "name": "owner", "type": "address"}, {"indexed": true, "internalType": "address", "name": "operator", "type": "address"}, {"indexed": false, "internalType": "bool", "name": "approved", "type": "bool"}], "name": "ApprovalForAll", "type": "event"}, {"anonymous": false, "inputs": [{"indexed": true, "internalType": "address", "name": "previousOwner", "type": "address"}, {"indexed": true, "internalType": "address", "name": "newOwner", "type": "address"}], "name": "OwnershipTransferred", "type": "event"}, {"anonymous": false, "inputs": [{"indexed": true, "internalType": "address", "name": "from", "type": "address"}, {"indexed": true, "internalType": "address", "name": "to", "type": "address"}, {"indexed": true, "internalType": "uint256", "name": "tokenId", "type": "uint256"}], "name": "Transfer", "type": "event"}, {"inputs": [{"internalType": "uint256", "name": "_id", "type": "uint256"}], "name": "_exists", "outputs": [{"internalType": "bool", "name": "", "type": "bool"}], "stateMutability": "view", "type": "function"}, {"inputs": [{"internalType": "address", "name": "_approved", "type": "address"}, {"internalType": "uint256", "name": "_id", "type": "uint256"}], "name": "approve", "outputs": [], "stateMutability": "nonpayable", "type": "function"}, {"inputs": [{"internalType": "address", "name": "_owner", "type": "address"}], "name": "balanceOf", "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}], "stateMutability": "view", "type": "function"}, {"inputs": [], "name": "cap", "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}], "stateMutability": "view", "type": "function"}, {"inputs": [{"internalType": "uint256", "name": "_id", "type": "uint256"}], "name": "getApproved", "outputs": [{"internalType": "address", "name": "", "type": "address"}], "stateMutability": "view", "type": "function"}, {"inputs": [{"internalType": "address", "name": "_owner", "type": "address"}, {"internalType": "address", "name": "_operator", "type": "address"}], "name": "isApprovedForAll", "outputs": [{"internalType": "bool", "name": "", "type": "bool"}], "stateMutability": "view", "type": "function"}, {"inputs": [], "name": "metadataUri", "outputs": [{"internalType": "string", "name": "", "type": "string"}], "stateMutability": "view", "type": "function"}, {"inputs": [{"internalType": "address", "name": "_recipient", "type": "address"}, {"internalType": "uint256", "name": "_amount", "type": "uint256"}], "name": "mint_Qgo", "outputs": [], "stateMutability": "nonpayable", "type": "function"}, {"inputs": [], "name": "name", "outputs": [{"internalType": "string", "name": "", "type": "string"}], "stateMutability": "view", "type": "function"}, {"inputs": [], "name": "owner", "outputs": [{"internalType": "address", "name": "", "type": "address"}], "stateMutability": "view", "type": "function"}, {"inputs": [{"internalType": "uint256", "name": "_id", "type": "uint256"}], "name": "ownerOf", "outputs": [{"internalType": "address", "name": "", "type": "address"}], "stateMutability": "view", "type": "function"}, {"inputs": [], "name": "renounceOwnership", "outputs": [], "stateMutability": "nonpayable", "type": "function"}, {"inputs": [{"internalType": "address", "name": "_from", "type": "address"}, {"internalType": "address", "name": "_to", "type": "address"}, {"internalType": "uint256", "name": "_id", "type": "uint256"}], "name": "safeTransferFrom", "outputs": [], "stateMutability": "nonpayable", "type": "function"}, {"inputs": [{"internalType": "address", "name": "_from", "type": "address"}, {"internalType": "address", "name": "_to", "type": "address"}, {"internalType": "uint256", "name": "_id", "type": "uint256"}, {"internalType": "bytes", "name": "_data", "type": "bytes"}], "name": "safeTransferFrom", "outputs": [], "stateMutability": "nonpayable", "type": "function"}, {"inputs": [{"internalType": "address", "name": "_newAdmin", "type": "address"}, {"internalType": "bool", "name": "_isAdmin", "type": "bool"}], "name": "setAdmin", "outputs": [], "stateMutability": "nonpayable", "type": "function"}, {"inputs": [{"internalType": "address", "name": "_operator", "type": "address"}, {"internalType": "bool", "name": "_approved", "type": "bool"}], "name": "setApprovalForAll", "outputs": [], "stateMutability": "nonpayable", "type": "function"}, {"inputs": [{"internalType": "string", "name": "_uri", "type": "string"}], "name": "setURI", "outputs": [], "stateMutability": "nonpayable", "type": "function"}, {"inputs": [{"internalType": "bytes4", "name": "_interfaceId", "type": "bytes4"}], "name": "supportsInterface", "outputs": [{"internalType": "bool", "name": "", "type": "bool"}], "stateMutability": "view", "type": "function"}, {"inputs": [], "name": "symbol", "outputs": [{"internalType": "string", "name": "", "type": "string"}], "stateMutability": "view", "type": "function"}, {"inputs": [{"internalType": "uint256", "name": "_id", "type": "uint256"}], "name": "tokenURI", "outputs": [{"internalType": "string", "name": "", "type": "string"}], "stateMutability": "view", "type": "function"}, {"inputs": [], "name": "totalSupply", "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}], "stateMutability": "view", "type": "function"}, {"inputs": [{"internalType": "address", "name": "_from", "type": "address"}, {"internalType": "address", "name": "_to", "type": "address"}, {"internalType": "uint256", "name": "_id", "type": "uint256"}], "name": "transferFrom", "outputs": [], "stateMutability": "nonpayable", "type": "function"}, {"inputs": [{"internalType": "address", "name": "newOwner", "type": "address"}], "name": "transferOwnership", "outputs": [], "stateMutability": "nonpayable", "type": "function"}
		];

		// Instantiate an Infura provider.
		const infuraProvider = new ethers.providers.InfuraProvider(
			'mainnet',
			INFURA_PROJECT_ID
		);

		// Establish connection to the contracts.
		const bonklerAuction = new ethers.Contract(
			BONKLER_AUCTION_ADDRESS,
			BONKLER_AUCTION_ABI,
			infuraProvider
		);
		const bonkletBidder0 = new ethers.Contract(
			BONKLET_BIDDER_0,
			BONKLET_BIDDER_ABI,
			infuraProvider
		);
		const bonkletBidder1 = new ethers.Contract(
			BONKLET_BIDDER_1,
			BONKLET_BIDDER_ABI,
			infuraProvider
		);
		const bonklerNFT = new ethers.Contract(
			BONKLER_NFT_ADDRESS,
			BONKLER_NFT_ABI,
			infuraProvider
		);
		const bonkletNFT = new ethers.Contract(
			BONKLET_NFT_ADDRESS,
			BONKLET_NFT_ABI,
			infuraProvider
		);

		// Populate the Bonkler leaderboard.
		(async function () {
			const nextBonklerId = await bonklerNFT.nextTokenId();

			// TODO: this is a disgusting hack. Cache it off-chain.
			// Find the owner and share power of each Bonkler.
			const bonkletBidderAddresses = [
				'0x95F75bc6Bbd1a5C3474a61a0514F519389262FE6',
				'0x7964929Ecbaf3F9704edCd6120126F6E85900883'
			];
			const bonklerOwners = {};
			for (let i = 1; i < nextBonklerId; i++) {
				try {
					let owner = await bonklerNFT.ownerOf(i);
					const ens = await infuraProvider.lookupAddress(owner);
					const shares = await bonklerNFT.getBonklerShares(i);
					if (shares.eq(0)) {
						continue;
					}

					// Combine Bonklet addresses.
					if (bonkletBidderAddresses.includes(owner)) {
						owner = 'Bonklets';
					}

					// Add or update an owner with their cumulative share count.
					if (!bonklerOwners[owner]) {
						bonklerOwners[owner] = {
							name: ens ? ens : owner,
							shares: shares
						};
					} else {
						bonklerOwners[owner] = {
							name: ens ? ens : owner,
							shares: bonklerOwners[owner].shares.add(shares)
						};
					}
				} catch (error) {
					continue;
				}
			}

			// Process Bonklets v0 to identify subholders.
			for (let i = 1; i < 5; i++) {
				const owner = await bonkletNFT.ownerOf(i);
				const ens = await infuraProvider.lookupAddress(owner);
				const data = await bonkletBidder0.bonkletData(i);

				// Add or update an owner with their cumulative share count.
				if (!bonklerOwners[owner]) {
					bonklerOwners[owner] = {
						name: ens ? ens : owner,
						shares: data.stagedEther
					};
				} else {
					bonklerOwners[owner] = {
						name: ens ? ens : owner,
						shares: bonklerOwners[owner].shares.add(data.stagedEther)
					};
				}
			}

			// Process Bonklets v1 to identify subholders.
			const bonkletSupply = await bonkletNFT.totalSupply();
			for (let i = 5; i < bonkletSupply; i++) {
				const owner = await bonkletNFT.ownerOf(i);
				const ens = await infuraProvider.lookupAddress(owner);
				const data = await bonkletBidder1.bonkletData(i);

				// Add or update an owner with their cumulative share count.
				if (!bonklerOwners[owner]) {
					bonklerOwners[owner] = {
						name: ens ? ens : owner,
						shares: data.stagedEther
					};
				} else {
					bonklerOwners[owner] = {
						name: ens ? ens : owner,
						shares: bonklerOwners[owner].shares.add(data.stagedEther)
					};
				}
			}

			// Sort all shareholders.
			const holders = Object.values(bonklerOwners).sort(
				(a, b) => b.shares.sub(a.shares)
			);

			// Update the leaderboard.
			const leaderboard = document.getElementById('leaderboard');
			leaderboard.innerHTML = '';
			for (const holder of holders) {
				const element = document.createElement('li');
				element.innerHTML = `${holder.name} - ${ethers.utils.formatEther(holder.shares)}`;
				leaderboard.appendChild(element);
			}
		})();

		// Retrieve important Bonkler auction details.
		let bonklerId;
		let generationHash;
		async function retrieveBonklerDetails() {

			// Update the Bonkler generation hash.
			const bonklerResponse = await fetch(
				'https://bonkler.remilia.org/bonkler?c=1'
			);
			const bonklerJSON = await bonklerResponse.json();
			generationHash = bonklerJSON.generationHash;

			// Retrieve auction details.
			const bonklerAuctionData = await bonklerAuction.auctionData();
			bonklerId = bonklerAuctionData.bonklerId;
			const bidAmount = bonklerAuctionData.amount;
			const winningBidder = bonklerAuctionData.bidder;
			const endTime = bonklerAuctionData.endTime;
			const duration = endTime - Math.floor((new Date()).getTime() / 1000);
			const hours = Math.floor(duration / (60 * 60)) + '';
			const minutes = Math.floor((duration - (hours * 60 * 60)) / 60) + '';
			const seconds = Math.floor(duration - (hours * 60 * 60) - (minutes * 60))
				+ '';

			// Update the Bonkler display.
			const bonklerDetails = document.getElementById('bonkler-details');
			bonklerDetails.textContent = `${winningBidder} is winning Bonkler ${bonklerId} with ${ethers.utils.formatEther(bidAmount)} Ether; the auction ends in ${hours}:${minutes.padStart(2, '0')}:${seconds.padStart(2, '0')}.`;

			// Retrieve Bonklet bidder details.
			const status = (winningBidder == BONKLET_BIDDER_1)
				? 'winning' : 'losing';
			const stagedTotal = await bonkletBidder1.stagedTotal(bonklerId);

			// Update the Bonklet display.
			const bonkletDetails = document.getElementById('bonklet-details');
			bonkletDetails.textContent = `The Bonklet bidder is currently ${status}, with a bid of ${ethers.utils.formatEther(stagedTotal)} Ether.`;
		};

		// Periodically poll the Bonkler auction.
		retrieveBonklerDetails();
		(function poll() {
			setTimeout(async () => {
				retrieveBonklerDetails();
				poll();
			}, POLL_RATE);
		})();

		// Upon mint being requested, retrieve the signer.
		document.getElementById('contribute-bid').addEventListener('click',
			async function (event) {

				// Retrieve the current user's signer.
				const provider = new ethers.providers.Web3Provider(
					window.ethereum,
					'any'
				);
				await provider.send('eth_requestAccounts', []);
				const signer = provider.getSigner();
				const address = await signer.getAddress();

				// Issue the stage bid transaction.
				const bidAmount = document.getElementById('bid-amount');
				let amount = bidAmount.value;
				await bonkletBidder1.connect(signer).stageBid(
					bonklerId,
					generationHash,
					{
						value: ethers.utils.parseEther(amount)
					}
				);
			});
	</script>
</body>

</html>
